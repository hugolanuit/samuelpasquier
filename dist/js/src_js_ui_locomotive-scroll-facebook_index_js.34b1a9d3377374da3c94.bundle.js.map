{"version":3,"file":"js/src_js_ui_locomotive-scroll-facebook_index_js.34b1a9d3377374da3c94.bundle.js","mappings":"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","sources":["webpack://samuelpasquier/./src/js/utils/facebook-sdk.js","webpack://samuelpasquier/./src/js/ui/locomotive-scroll-facebook/LocomotiveScrollFacebook.js","webpack://samuelpasquier/./src/js/ui/locomotive-scroll-facebook/index.js"],"sourcesContent":["import { $, head, body } from \"@utils/dom\";\n\nclass FacebookSDK {\n  constructor() {\n    this._fbRoot = $('#fb-root');\n    this._script = null;\n    this._ready = false;\n    this._xfbmlInitialized = false;\n    this._promises = [];\n\n    this._onXFBMLReady = this._onXFBMLReady.bind(this);\n\n    window.fbAsyncInit = () => {\n      FB.Event.subscribe('xfbml.ready', this._onXFBMLReady);\n\n      this._ready = true;\n      this._promises.forEach(promise => promise());\n      this._promises = null;\n\n      window.fbAsyncInit = null;\n    }\n  }\n\n  load() {\n    // if already loaded, return an auto-resolving Promise\n    if( this._ready ) return Promise.resolve();\n\n    // save promise for future\n    const promise = new Promise((resolve) => this._promises.push(resolve));\n\n    // make sur div#fb-root exist on the page\n    if( !this._fbRoot ) {\n      this._fbRoot = document.createElement('div');\n      this._fbRoot.id = 'fb-root';\n\n      body.appendChild(this._fbRoot);\n    }\n\n    // load Facebook SDK once\n    if( !this._script ) {\n      this._script = document.createElement(\"script\");\n      this._script.id = \"facebook-jssdk\";\n      this._script.setAttribute(\"crossorigin\", \"anonymous\");\n      this._script.onerror = e => { console.error(\"Error loading Youtube iFrame API :\", e); };\n      this._script.src = \"https://connect.facebook.net/en_US/sdk.js#xfbml=1&version=v10.0\";\n      //this._script.src = \"https://connect.facebook.net/en_US/sdk/debug.js#xfbml=1&version=v10.0\";\n\n      head.appendChild(this._script);\n    }\n\n    return promise;\n  }\n\n  _onXFBMLReady() { this._xfbmlInitialized = true; }\n\n  // getter\n  get ready() { return this._ready; }\n  get xfbmlInitialized() { return this._xfbmlInitialized; }\n}\n\nconst SINGLETON = new FacebookSDK();\nexport default SINGLETON;\n","import { $$, wrap } from \"@utils/dom\";\nimport { mobile } from \"@utils/mobile\";\nimport FacebookSDK from \"@utils/facebook-sdk\";\n\nexport const SELECTOR = `.wysiwyg iframe[src*=\"facebook.com/plugins/video\"]`;\n\nconst STATUS_DESTROYED = 0;\nconst STATUS_INITIALIZED = 1;\nconst STATUS_STOPPED = 2;\nconst STATUS_STARTED = 3;\n\nlet UDID = 1;\n\nclass LocomotiveScrollFacebook {\n  constructor(init = false) {\n    this.items = null;\n\n    this._elements = null;\n    this._status = STATUS_DESTROYED;\n\n    this._initChildren = this._initChildren.bind(this);\n\n    init ? this.init() : null;\n  }\n\n  init() {\n    // do nothing for mobile\n    if (mobile) return;\n\n    // query all elements that will turn into LocomotiveScrollFacebookItem later\n    this._elements = Array.from($$(SELECTOR));\n\n    // if there is no elements, skip here\n    if( !this._elements || this._elements.length === 0 ) return;\n\n    // set status as initialized\n    this._status = STATUS_INITIALIZED;\n\n    // load Facebook SDK\n    FacebookSDK.load().then(() => {\n      // if status is lower than initialized (ex: destroyed), do nothing\n      if( this._status < STATUS_INITIALIZED ) return;\n      \n      // create childs\n      this._initChildren();\n\n      // if status is started, start childs\n      if( this._status === STATUS_STARTED ) this.start();\n    });\n  }\n\n  destroy() {\n    if (this.items) this.items.forEach(el => el.destroy());\n    this.items = null;\n\n    this._elements = null;\n    this._status = STATUS_DESTROYED;\n  }\n\n  start() {\n    this._status = STATUS_STARTED;\n    if (this.items) this.items.forEach(el => el.start());\n  }\n\n  stop() {\n    if (this.items) this.items.forEach(el => el.stop());\n    this._status = STATUS_STOPPED;\n  }\n\n  _initChildren() {\n    // create childs instance\n    this.items = this._elements.map(el => new LocomotiveScrollFacebookItem(el, this.emitter));\n    this._elements = null;\n  }\n}\n\nclass LocomotiveScrollFacebookItem {\n  constructor(el, emitter) {\n    this.el = el;\n    this.emitter = emitter;\n\n    this.udid = `facebook-smooth-scroll--${UDID++}`;\n    this.fbVideo = null;\n\n    this._playerStartHandler = null;\n    this._playerPauseHandler = null;\n    this._playerFinishedHandler = null;\n\n    this._onXFBMLReady = this._onXFBMLReady.bind(this);\n    this._onClick = this._onClick.bind(this);\n    this._onPlaybackStarted = this._onPlaybackStarted.bind(this);\n    this._onPlaybackPaused = this._onPlaybackPaused.bind(this);\n    this._onPlaybackFinished = this._onPlaybackFinished.bind(this);\n\n    this.init();\n  }\n\n  init() {\n    this.wrapper = document.createElement('div');\n    this.wrapper.classList.add('facebook-video__wrapper', 'box', 'box-widescreen');\n\n    wrap(this.el, this.wrapper);\n    this.emitter.emit('SiteScroll.update');\n  }\n  destroy() {\n    if (this._playerStartHandler) this._playerStartHandler.release('startedPlaying');\n    if (this._playerPauseHandler) this._playerPauseHandler.release('paused');\n    if (this._playerFinishedHandler) this._playerFinishedHandler.release('finishedPlaying');\n    if (this.player) this.player.pause();\n\n    this.el = null;\n    this.emitter = null;\n    this.player = null;\n    this.udid = null;\n    this.fbVideo = null;\n\n    this._playerStartHandler = null;\n    this._playerPauseHandler = null;\n    this._playerFinishedHandler = null;\n\n    this._onXFBMLReady = null;\n    this._onClick = null;\n    this._onPlaybackStarted = null;\n    this._onPlaybackPaused = null;\n    this._onPlaybackFinished = null;\n  }\n  start() {\n    this._bindEvents();\n  }\n  stop() {\n    this._unbindEvents();\n\n    if (this.player) {\n      //this.player.removeEventListener(\"onReady\", this._onReady);\n      //this.player.removeEventListener(\"onStateChange\", this._onStateChange);\n    }\n  }\n\n  _bindEvents() {\n    this.wrapper.classList.add('--enable-smooth-scroll');\n    this.wrapper.removeEventListener(\"click\", this._onClick);\n    this.wrapper.addEventListener(\"click\", this._onClick);\n  }\n  _unbindEvents() {\n    this.wrapper.removeEventListener(\"click\", this._onClick);\n    this.wrapper.classList.remove('--enable-smooth-scroll');\n  }\n  \n  _onXFBMLReady(msg) {\n    const { type, id, instance } = msg;\n\n    // if event is related to this element, save video instance and bind listeners\n    if (type === 'video' && id === this.udid) {\n      FB.Event.unsubscribe('xfbml.ready', this._onXFBMLReady);\n\n      this._playerStartHandler = instance.subscribe('startedPlaying', this._onPlaybackStarted);\n      this._playerPauseHandler = instance.subscribe('paused', this._onPlaybackPaused);\n      this._playerFinishedHandler = instance.subscribe('finishedPlaying', this._onPlaybackFinished);\n      \n      this.player = instance;\n      this.player.play();\n      this.wrapper.removeChild( this.el );\n    }\n  }\n  _onClick(event) {\n    if (event) {\n      event.stopImmediatePropagation();\n      event.preventDefault();\n    }\n\n    if( !this.fbVideo ) {\n      const src = decodeURIComponent(this.el.src);\n      const params = src.split('?').pop().split('&').map(str => str.split('='));\n      const href = params.find(param => param[0] === 'href');\n\n      this.fbVideo = document.createElement('div');\n      this.fbVideo.id = this.udid;\n      this.fbVideo.classList.add('fb-video');\n      this.fbVideo.setAttribute('data-href', href[1]);\n      this.fbVideo.setAttribute('data-autoplay', true);\n      this.fbVideo.setAttribute('data-allowfullscreen', true);\n      this.wrapper.appendChild( this.fbVideo );\n\n      FB.Event.subscribe('xfbml.ready', this._onXFBMLReady);\n      FB.XFBML.parse(this.wrapper);\n    }\n    else if( this.player ) this.player.play();\n  }\n  _onPlaybackStarted() { \n    this._unbindEvents();\n  }\n  _onPlaybackPaused() { this._bindEvents(); }\n  _onPlaybackFinished() { this._bindEvents(); }\n}\n\nexport default LocomotiveScrollFacebook;\n","import LocomotiveScrollFacebook from \"./LocomotiveScrollFacebook\";\n\nexport const instance = new LocomotiveScrollFacebook();\n\nexport default { instance };\n"],"names":["FacebookSDK","this","_fbRoot","$","_script","_ready","_xfbmlInitialized","_promises","_onXFBMLReady","bind","window","fbAsyncInit","FB","Event","subscribe","forEach","promise","load","Promise","resolve","push","document","createElement","id","body","setAttribute","onerror","e","console","error","src","head","ready","xfbmlInitialized","UDID","LocomotiveScrollFacebook","init","items","_elements","_status","_initChildren","mobile","Array","from","$$","length","then","start","destroy","el","stop","map","LocomotiveScrollFacebookItem","emitter","udid","fbVideo","_playerStartHandler","_playerPauseHandler","_playerFinishedHandler","_onClick","_onPlaybackStarted","_onPlaybackPaused","_onPlaybackFinished","wrapper","classList","add","wrap","emit","release","player","pause","_bindEvents","_unbindEvents","removeEventListener","addEventListener","remove","msg","type","instance","unsubscribe","play","removeChild","event","stopImmediatePropagation","preventDefault","href","decodeURIComponent","split","pop","str","find","param","appendChild","XFBML","parse"],"sourceRoot":""}