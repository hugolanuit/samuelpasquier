{"version":3,"file":"js/src_js_modules_newsletter_index_js.dd724beddb2ffd875fdc.bundle.js","mappings":"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","sources":["webpack://samuelpasquier/./src/js/modules/module/Module.js","webpack://samuelpasquier/./src/js/modules/newsletter/Newsletter.js","webpack://samuelpasquier/./src/js/modules/newsletter/index.js","webpack://samuelpasquier/./src/js/modules/newsletter/factory.js"],"sourcesContent":["class Module {\n  init() {}\n\n  // called during Barba's afterEnter hook.\n  start() {}\n\n  // called during Barba's beforeLeave hook.\n  stop() {}\n\n  // called during Barba's afterLeave hook.\n  destroy() {}\n\n  // getter - setter\n  get name() {\n    return null;\n  }\n}\n\nexport default Module;\n","import axios from 'axios';\nimport serialize from 'form-serialize';\n\nimport { $ } from \"@utils/dom\";\nimport { on, off } from \"@utils/listener\";\n\nconst CLASSNAME = \"--filled\";\nconst VALIDATION_CLASSNAME = '--validation-reported';\nconst SUCCESS_CLASSNAME = '--wp-success';\nconst ERROR_CLASSNAME = '--wp-error';\nconst OUTPUT_DELAY = 5000;\n\nclass Newsletter {\n  constructor(el) {\n    this.el = el;\n    this.form = $('.newsletter__form', this.el);\n    this.input = $('.newsletter__form__input', this.form);\n    this.btn = $('.newsletter__form__submit', this.form);\n    this.output = $('.newsletter__form__output', this.form);\n\n    this._waiting = false;\n    this._timer = null;\n\n    this._onFocus = this._onFocus.bind(this);\n    this._onBlur = this._onBlur.bind(this);\n    this._onSubmit = this._onSubmit.bind(this);\n    this._onSubmitCallback = this._onSubmitCallback.bind(this);\n    this._onSubmitError = this._onSubmitError.bind(this);\n    this._onReset = this._onReset.bind(this);\n    this._send = this._send.bind(this);\n    this._removeOutputMessage = this._removeOutputMessage.bind(this);\n    \n    this.init();\n  }\n  \n  init() {\n    if (this.input) {\n      on(this.input, \"focus\", this._onFocus);\n      on(this.input, \"blur\", this._onBlur);\n\n      const value = this.input.value.trim();\n      if (value) this._onFocus();\n    }\n\n    if (this.form) {\n      on(this.form, \"submit\", this._onSubmit);\n      on(this.form, \"reset\", this._onReset);\n    }\n  }\n  destroy() {\n    if( this.input ) {\n      off(this.input, \"focus\", this._onFocus);\n      off(this.input, \"blur\", this._onBlur);\n    }\n\n    if( this.form ) {\n      off(this.form, \"submit\", this._onSubmit);\n      off(this.form, \"reset\", this._onReset);\n    }\n\n    this.el = null;\n    this.form = null;\n    this.input = null;\n    this.btn = null;\n    this.output = null;\n\n    this._onFocus = null;\n    this._onBlur = null;\n    this._onSubmit = null;\n    this._onSubmitCallback = null;\n    this._onSubmitError = null;\n    this._onReset = null;\n    this._send = null;\n    this._removeOutputMessage = null;\n  }\n\n  _onFocus() {\n    if( this._timer ) clearTimeout( this._timer );\n    this._timer = null;\n\n    if( this.form.classList.contains(SUCCESS_CLASSNAME) ) {\n      this.form.classList.remove(SUCCESS_CLASSNAME);\n      if( this.output ) this.output.innerHTML = '';\n    }\n\n    this.form.classList.add(CLASSNAME);\n  }\n  _onBlur() {\n    // check if input is empty\n    if (this.input) {\n      const value = this.input.value.trim();\n      if (value) return;\n    }\n\n    this.form.classList.remove(CLASSNAME);\n  }\n  _onSubmit(event) {\n    if( event ) {\n      event.preventDefault();\n      event.stopImmediatePropagation();\n    }\n\n    // remove previous success status\n    if( !this.form.classList.contains( SUCCESS_CLASSNAME ) )this.form.classList.remove(SUCCESS_CLASSNAME);\n\n    // add class to form informing fields that they can show their validity/invalidity status\n    if( !this.form.classList.contains( VALIDATION_CLASSNAME ) ) this.form.classList.add( VALIDATION_CLASSNAME );\n\n    // if native form validation is not supported\n    if( this.form.reportValidity ){\n\n      // if form validation fails, skip here\n      if( !this.form.reportValidity() ) return false;\n    }\n\n    // if form is already submitted\n    if( this._waiting === true ) return false;\n    this._waiting = true;\n\n    // cancel delayed reset of output message\n    if( this._timer ) clearTimeout( this._timer );\n    this._timer = null;\n\n    // disable submit button to prevent multiple click\n    if( this.btn ) this.btn.setAttribute('disabled', true);\n\n    // clear & hide output message\n    if( this.output ) {\n      this.output.classList.remove(ERROR_CLASSNAME);\n      this.output.innerHTML = '';\n    }\n\n    // invoke Google reCAPTCHA v3\n    if( window.grecaptcha && window.reCAPTCHA_SITE_KEY ) {\n      window.grecaptcha\n        .execute(window.reCAPTCHA_SITE_KEY, {action: 'newsletter'})\n        .then(this._send);\n    }\n    else this._send();\n\n    return false;\n  }\n  _onSubmitCallback(response) {\n    const { success, message, errors } = response.data;\n\n    if( success ) {\n      this.form.classList.remove(VALIDATION_CLASSNAME);\n      this.form.classList.add(SUCCESS_CLASSNAME);\n      this.form.reset();\n    }\n\n    // show output message only if there is no errors in fields\n    if( message && this.output && !errors ) {\n      if( !success ) this.output.classList.add(ERROR_CLASSNAME);\n      this.output.innerHTML = message;\n\n      if( success ) this._timer = setTimeout(this._removeOutputMessage, OUTPUT_DELAY);\n    }\n\n    // enabled submit button\n    if( this.btn ) this.btn.removeAttribute('disabled');\n    this._waiting = false;\n  }\n  _onSubmitError(error) {\n    // show output message\n    if( this.output ) {\n      this.output.classList.add(ERROR_CLASSNAME);\n      this.output.innerHTML = error;\n    }\n\n    // remove form validator\n    this.form.classList.remove( VALIDATION_CLASSNAME );\n\n    // enabled submit button\n    if( this.btn ) this.btn.removeAttribute('disabled');\n    this._waiting = false;\n  }\n  _onReset() {\n    this._onBlur();\n  }\n\n  _send(token = null) {\n    // send form via AJAX\n    const url = this.form.getAttribute('action');\n    let data = serialize(this.form);\n\n    // add token if available\n    if( token ) data += `&${encodeURIComponent('reCAPTCHA')}=${encodeURIComponent(token)}`;\n\n    axios.post(url, data)\n      .then(this._onSubmitCallback)\n      .catch(this._onSubmitError);\n  }\n  _removeOutputMessage() {\n    if( this._timer ) clearTimeout( this._timer );\n    this._timer = null;\n\n    if( this.form ) this.form.classList.remove(CLASSNAME, SUCCESS_CLASSNAME);\n    if( this.output ) this.output.innerHTML = '';\n  }\n}\n\nexport default Newsletter;","import Factory from \"./factory\";\n\nexport const instance = new Factory();\n\nexport default { instance };\n","import { $$ } from \"@utils/dom\";\n\nimport Module from \"../module/Module\";\nimport Newsletter from \"./Newsletter\";\n\nexport const SELECTOR = `[data-newsletter]`;\n\nclass Factory extends Module {\n  constructor(init = false) {\n    super();\n\n    this.initialized = false;\n    this.items = null;\n\n    init ? this.init() : null;\n  }\n\n  get name() {\n    return \"Newsletter\";\n  }\n\n  init() {\n    // set initialized\n    this.initialized = true;\n    this.items = [...$$(SELECTOR)].map(el => new Newsletter(el, this.emitter));\n  }\n  destroy() {\n    if (this.items) this.items.forEach(el => el.destroy());\n\n    this.initialized = false;\n    this.items = null;\n  }\n}\n\nexport default Factory;\n"],"names":["Module","init","start","stop","destroy","name","CLASSNAME","VALIDATION_CLASSNAME","SUCCESS_CLASSNAME","ERROR_CLASSNAME","Newsletter","el","this","form","$","input","btn","output","_waiting","_timer","_onFocus","bind","_onBlur","_onSubmit","_onSubmitCallback","_onSubmitError","_onReset","_send","_removeOutputMessage","on","value","trim","off","clearTimeout","classList","contains","remove","innerHTML","add","event","preventDefault","stopImmediatePropagation","reportValidity","setAttribute","window","grecaptcha","reCAPTCHA_SITE_KEY","execute","action","then","response","data","success","message","errors","reset","setTimeout","removeAttribute","error","token","url","getAttribute","serialize","encodeURIComponent","axios","catch","instance","Factory","initialized","items","$$","map","emitter","forEach"],"sourceRoot":""}