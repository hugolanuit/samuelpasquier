{"version":3,"file":"js/src_js_modules_video_index_js.394d1ebaa397194416bc.bundle.js","mappings":"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","sources":["webpack://samuelpasquier/./src/js/modules/module/Module.js","webpack://samuelpasquier/./src/js/utils/breakpoint.js","webpack://samuelpasquier/./src/js/modules/video/Video.js","webpack://samuelpasquier/./src/js/modules/video/factory.js","webpack://samuelpasquier/./src/js/modules/video/index.js"],"sourcesContent":["class Module {\n  init() {}\n\n  // called during Barba's afterEnter hook.\n  start() {}\n\n  // called during Barba's beforeLeave hook.\n  stop() {}\n\n  // called during Barba's afterLeave hook.\n  destroy() {}\n\n  // getter - setter\n  get name() {\n    return null;\n  }\n}\n\nexport default Module;\n","/*\n\n──────────────────────────────────────────\n──────────────────────────────────────────\nBREAKPOINT\n──────────────────────────────────────────\n──────────────────────────────────────────\n\nconst bp = Breakpoint(['(min-width: 768px)'], callback);\n\nbp.on();  // start listening to media query's match\nbp.off(); // stop listening to media query's match\nbp.run(); // execute object callback\n\nfunction resize(event) {\n  // do something\n}\n\n*/\n\nconst Breakpoint = (mediaQueries, cb) => {\n  // PRIVATE API\n  const getThrottle = (e) => {\n    event = e;\n\n    if (!tick) {\n      requestAnimationFrame(_run);\n      tick = true;\n    }\n  };\n\n  let listeners = mediaQueries.map((query) => window.matchMedia(query)),\n    tick = false,\n    event;\n\n  // PUBLIC API\n  const _on = () => {\n    listeners.forEach((mql) => mql.addListener(getThrottle));\n  };\n  const _off = () => {\n    listeners.forEach((mql) => mql.removeListener(getThrottle));\n  };\n  const _run = () => {\n    cb(event);\n    tick = false;\n  };\n  const _dispose = () => {\n    tick = true;\n    event = null;\n    listeners = null;\n  };\n\n  const ctx = {\n    dispose: _dispose,\n    on: _on,\n    off: _off,\n    run: _run\n  };\n\n  return ctx;\n};\n\nexport default Breakpoint;\n","import Breakpoint from \"@utils/breakpoint\";\nimport { on, off } from \"@utils/listener\";\nimport Viewport from \"@utils/viewport\";\n\nconst BREAKPOINTS = [\"(min-width: 768px)\"];\n\nclass Video {\n  constructor(el, emitter) {\n    this.el = el;\n    this.emitter = emitter;\n\n    this._action = null;\n    this._playPromise = null;\n    this._src = this.el.dataset.src;\n    this._src_mobile = this.el.dataset.srcMobile;\n\n    this._onBreakpointChange = this._onBreakpointChange.bind(this);\n    this._onMetadata = this._onMetadata.bind(this);\n\n    // listen to css breakpoints change\n    if (this._src && this._src_mobile) this._bp = Breakpoint(BREAKPOINTS, this._onBreakpointChange);\n\n    this.init();\n  }\n\n  init() {\n    this._bindEvents();\n\n    if (this._bp) this._bp.run();\n    else this._onBreakpointChange();\n  }\n  destroy() {\n    this._unbindEvents();\n\n    if (this._bp) this._bp.dispose();\n\n    this.el = null;\n    this.emitter = null;\n\n    this._action = null;\n    this._playPromise = null;\n    this._src = null;\n    this._src_mobile = null;\n    this._bp = null;\n\n    this._onBreakpointChange = null;\n    this._onMetadata = null;\n  }\n  play(force = false) {\n    // if video element does not exist, skip here\n    if (!this.el) return;\n\n    // if we already request play without forcing it, skip here\n    if (this._action === \"play\" && force === false) return;\n    this._action = \"play\";\n\n    // if promise exists, skip here\n    if (this._playPromise) return;\n\n    //console.log(\"play\", this.el.readyState);\n\n    // if video is not loaded, skip here\n    //if( this.el.readyState < 1 ) return;\n\n    // start playback and clear promise when done\n    this._playPromise = this.el?.play().finally(() => {\n      this._playPromise = null;\n    });\n  }\n  pause() {\n    // if video element does not exist, skip here\n    if (!this.el) return;\n\n    // if we already request pause, skip here\n    if (this._action === \"pause\") return;\n    this._action = \"pause\";\n\n    // if video cannot play, skip here\n    //if( this.el.readyState < 1 ) return;\n\n    // if a play promise exists, wait promise.resolve to pause playback\n    // otherwise, pause immediatly\n    if (this._playPromise) this._playPromise.then(() => this.el?.pause());\n    else this.el?.pause();\n  }\n\n  _bindEvents() {\n    on(this.el, \"loadedmetadata\", this._onMetadata);\n    this._bp?.on();\n  }\n  _unbindEvents() {\n    off(this.el, \"loadedmetadata\", this._onMetadata);\n    this._bp?.off();\n  }\n\n  _onBreakpointChange() {\n    this.el.setAttribute(\"src\", this.src);\n    if (this._action === \"play\") this.play(true);\n  }\n  _onMetadata() {\n    this.emitter?.emit(`SiteScroll.update`);\n  }\n\n  // getter - setter\n  get src() {\n    if (!this._src_mobile) return this._src;\n    return Viewport.width < 768 ? this._src_mobile : this._src;\n  }\n}\n\nexport default Video;\n","import { $$ } from \"@utils/dom\";\n\nimport Module from \"../module/Module\";\nimport Video from \"./Video\";\n\nexport const SELECTOR = `[data-module*=\"video\"]`;\n\nclass Factory extends Module {\n  constructor(init = false) {\n    super();\n\n    this.initialized = false;\n    this.items = null;\n\n    this._onScrollCall = this._onScrollCall.bind(this);\n\n    init ? this.init() : null;\n  }\n\n  get name() {\n    return \"Video\";\n  }\n\n  init() {\n    // set initialized\n    this.initialized = true;\n    this.items = [...$$(SELECTOR)].map(el => new Video(el, this.emitter));\n\n    this._bindEvents();\n  }\n  destroy() {\n    this._unbindEvents();\n\n    if (this.items) this.items.forEach(el => el.destroy());\n\n    this.initialized = false;\n    this.items = null;\n  }\n\n  _bindEvents() {\n    if (this.emitter) this.emitter.on(`SiteScroll.video`, this._onScrollCall);\n  }\n  _unbindEvents() {\n    if (this.emitter) this.emitter.off(`SiteScroll.video`, this._onScrollCall);\n  }\n  _onScrollCall(direction, { el }) {\n    if (!this.items) return;\n\n    const video = this.items.find(video => video.el === el);\n    if (!video) return;\n\n    // TODO: check if video is visible before calling is method (for responsive viewports)\n    video[direction === \"enter\" ? \"play\" : \"pause\"]();\n  }\n}\n\nexport default Factory;\n","import Factory from \"./factory\";\n\nexport const instance = new Factory();\n\nexport default { instance };\n"],"names":["Module","init","start","stop","destroy","name","mediaQueries","cb","event","getThrottle","e","tick","requestAnimationFrame","_run","listeners","map","query","window","matchMedia","dispose","on","forEach","mql","addListener","off","removeListener","run","BREAKPOINTS","Video","el","emitter","this","_action","_playPromise","_src","dataset","src","_src_mobile","srcMobile","_onBreakpointChange","bind","_onMetadata","_bp","Breakpoint","_bindEvents","_unbindEvents","play","force","finally","pause","then","setAttribute","emit","Viewport","Factory","initialized","items","_onScrollCall","$$","direction","video","find","instance"],"sourceRoot":""}