{"version":3,"file":"js/src_js_ui_site-scroll_index_js.18da7212fcdb4961f972.bundle.js","mappings":"g4CAMO,IAUHA,EATSC,EAAuB,kBACvBC,EAAwB,mBACxBC,EAAsB,iBACtBC,EAA2B,uBAQlCC,EAAN,W,SAAMA,I,IACQC,EAAO,UAAH,8C,UACdC,KAAKC,aAAc,EACnBD,KAAKE,2BAA4B,EACjCF,KAAKG,gBAAkB,KACvBH,KAAKI,gBAAkB,KACvBJ,KAAKK,GAAK,KAEVZ,EAAYO,KAEZA,KAAKM,QAAUN,KAAKM,QAAQC,KAAKP,MACjCA,KAAKQ,UAAYR,KAAKQ,UAAUD,KAAKP,MACrCA,KAAKS,UAAYT,KAAKS,UAAUF,KAAKP,MAErCA,KAAKU,MAAQV,KAAKU,MAAMH,KAAKP,MAC7BA,KAAKW,KAAOX,KAAKW,KAAKJ,KAAKP,MAC3BA,KAAKY,OAASZ,KAAKY,OAAOL,KAAKP,MAC/BA,KAAKa,SAAWb,KAAKa,SAASN,KAAKP,MACnCA,KAAKc,SAAWd,KAAKc,SAASP,KAAKP,MAEnCD,GAAOC,KAAKD,O,yBAGVgB,IAAAA,O,IAAJ,WACE,MAAQ,e,CAOVhB,IAAAA,O,MAAAA,WACEC,KAAKC,aAAc,EACnBD,KAAKE,2BAA4B,EACjCF,KAAKG,gBAAkB,KACvBH,KAAKI,gBAAkB,EACvBJ,KAAKK,IAAKW,EAAAA,EAAAA,GAhDU,2BAiDpBhB,KAAKiB,eAAiB,GAAKC,EAAAA,EAAAA,IA5CQ,uCA4CoBlB,KAAKK,KAAMc,KAAIC,SAAAA,GACpE,MAAO,CACLA,QAASA,EACTC,OAAQD,EAAQE,sBAIftB,KAAKuB,KAAKvB,KAAKuB,IAAKC,EAAAA,EAAAA,GAAkBxB,KAAKS,YAChDT,KAAKuB,GAAGE,MAERzB,KAAK0B,OAAS,IAAIC,EAAAA,GAAiB,CACjCtB,GAAIL,KAAKK,GACTuB,QAAQ,EACRC,QAAQ,EACRC,OAAQ,CACNC,WAAY,KAIhB/B,KAAK0B,OAAOM,GAAG,OAAQhC,KAAKM,SAC5BN,KAAK0B,OAAOM,GAAG,SAAUhC,KAAKQ,WAE9BR,KAAKiC,gB,CAGPC,IAAAA,U,MAAAA,WACMlC,KAAKuB,IAAIvB,KAAKuB,GAAGY,MACjBnC,KAAK0B,SACP1B,KAAK0B,OAAOS,IAAI,OAAQnC,KAAKM,SAC7BN,KAAK0B,OAAOS,IAAI,SAAUnC,KAAKQ,WAC/BR,KAAK0B,OAAOQ,WAGVlC,KAAKoC,UACPpC,KAAKoC,QAAQD,IAAK,GAAY,OAAVnC,KAAKe,KAAK,SAAQf,KAAKW,MAC3CX,KAAKoC,QAAQD,IAAK,GAAY,OAAVnC,KAAKe,KAAK,UAASf,KAAKU,OAC5CV,KAAKoC,QAAQD,IAAK,GAAY,OAAVnC,KAAKe,KAAK,WAAUf,KAAKY,QAC7CZ,KAAKoC,QAAQD,IAAK,GAAY,OAAVnC,KAAKe,KAAK,aAAYf,KAAKa,UAC/Cb,KAAKoC,QAAQD,IAAK,GAAY,OAAVnC,KAAKe,KAAK,aAAYf,KAAKc,WAGjDd,KAAKK,GAAK,KACVL,KAAKiB,eAAiB,KACtBjB,KAAK0B,OAAS,KACd1B,KAAKC,aAAc,EACnBD,KAAKE,2BAA4B,EACjCF,KAAKG,gBAAkB,KACvBH,KAAKI,gBAAkB,O,CAGzBQ,IAAAA,S,MAAAA,WACMZ,KAAKuB,IAAIvB,KAAKuB,GAAGE,MACjBzB,KAAK0B,QAAQ1B,KAAK0B,OAAOd,W,CAG/BF,IAAAA,Q,MAAAA,WACOV,KAAK0B,SACV1B,KAAK0B,OAAOhB,QACZ2B,EAAAA,GAAAA,UAAAA,OAAsBxC,M,CAGxBc,IAAAA,O,MAAAA,WACOX,KAAK0B,SACV1B,KAAK0B,OAAOf,OACZ0B,EAAAA,GAAAA,UAAAA,IAAmBxC,M,CAGrBgB,IAAAA,W,MAAAA,SAASQ,G,IAAQiB,EAAS,UAAH,6CAAG,EACpBtC,KAAK0B,QAAQ1B,KAAK0B,OAAOb,SAASQ,EAAQ,CAAEiB,OAASA,M,CAG3DxB,IAAAA,W,MAAAA,WACMd,KAAK0B,QAAQ1B,KAAK0B,OAAOb,SAAS,EAAG,EAAG,O,CAG9CoB,IAAAA,c,MAAAA,WAEMjC,KAAKuB,IAAKvB,KAAKuB,GAAGS,KAGjBhC,KAAKoC,UAEVpC,KAAKoC,QAAQJ,GAAI,GAAY,OAAVhC,KAAKe,KAAK,SAAQf,KAAKW,MAC1CX,KAAKoC,QAAQJ,GAAI,GAAY,OAAVhC,KAAKe,KAAK,UAASf,KAAKU,OAC3CV,KAAKoC,QAAQJ,GAAI,GAAY,OAAVhC,KAAKe,KAAK,WAAUf,KAAKY,QAC5CZ,KAAKoC,QAAQJ,GAAI,GAAY,OAAVhC,KAAKe,KAAK,aAAYf,KAAKa,UAC9Cb,KAAKoC,QAAQJ,GAAI,GAAY,OAAVhC,KAAKe,KAAK,aAAYf,KAAKc,a,CAKhDR,IAAAA,U,MAAAA,SAAQiC,EAAMC,EAAWC,G,WACnBC,MAAMC,QAAQJ,GAAOA,EAAKK,SAAQC,SAAAA,GAAK,OAAM,EAADC,aAAaD,EAAGL,EAAWC,MACtEzC,KAAK8C,aAAaP,EAAMC,EAAWC,K,CAK1CK,IAAAA,e,MAAAA,SAAaC,EAAMP,EAAWC,GAC5BzC,KAAKoC,QAAQY,KAAM,GAAeD,OAAb/C,KAAKe,KAAK,KAAQ,OAALgC,GAAQP,EAAWC,K,CAGvDjC,IAAAA,Y,MAAAA,SAAUyC,GACR,IAAQC,EAAMD,EAASvB,OAAfwB,EACFC,EAAOD,EAAIlD,KAAKI,gBAChBoC,EAAYW,GAAQ,EAAI,OAAS,KACjCC,EAAYF,EApJG,IAqJfG,EAAeC,KAAKC,IAAIJ,IApJJ,EAuJ1BnD,KAAKI,gBAAkB8C,EAGvBlD,KAAKoC,QAAQY,KAAM,GAAY,OAAVhD,KAAKe,KAAK,WAAUmC,IAGvB,IAAdE,IAAyD,IAAnCpD,KAAKE,2BAC7BF,KAAKE,2BAA4B,EACjCF,KAAKwD,MAAMC,SAAS,cAAc,GAElCC,EAAAA,GAAAA,UAAAA,IAAmBhE,KAGE,IAAd0D,IAA0D,IAAnCpD,KAAKE,4BACnCF,KAAKE,2BAA4B,EACjCF,KAAKwD,MAAMC,SAAS,cAAc,GAElCC,EAAAA,GAAAA,UAAAA,OAAsBhE,IAIpB2D,GAAgBb,IAAcxC,KAAKwC,YAEd,OAAnBxC,KAAKwC,UACPkB,EAAAA,GAAAA,UAAAA,IAAiC,SAAdlB,EAAuB7C,EAAwBC,GAC7C,SAAd4C,EAAsBkB,EAAAA,GAAAA,UAAAA,QAAuB9D,EAAqBD,GACtE+D,EAAAA,GAAAA,UAAAA,QAAuB/D,EAAuBC,GAGnDI,KAAKG,gBAAkBqC,EAGvBxC,KAAKwD,MAAMC,SAAS,mBAAoBjB,GAGxCxC,KAAKoC,QAAQY,KAAM,GAAY,OAAVhD,KAAKe,KAAK,cAAayB,M,CAIhD/B,IAAAA,Y,MAAAA,WAEMkD,EAAAA,GAGJ3D,KAAKiB,eAAe2B,SAAQ,SAAQ,G,IAANxB,EAAO,EAAPA,QAASC,EAAM,EAANA,OAC7BuC,GAAWC,EAAAA,EAAAA,IAAKxC,GAAhBuC,OACRxC,EAAQ0C,MAAMC,YAAY,eAAiB,GAAqB,OAAnBT,KAAKU,MAAMJ,GAAQ,Y,CAKhEV,IAAAA,I,IAAJ,WACE,OAAOlD,KAAK0B,OAAS1B,KAAK0B,OAAOA,OAAOuB,SAASvB,OAAOwB,EAAI,I,CAE1DV,IAAAA,Y,IAAJ,WACE,OAAOxC,KAAKG,mB,IA/KP8D,IAAAA,e,MAAP,WACE,OAAOxE,K,gCA5BX,GChBO,IAAMwD,EAAW,ID8NxB,EC5NA,SAAiBA,SAAAA,I,8HCmEjB,QAhD0B,SAACiB,G,IAarBC,EAAMC,EAbmBC,EAAQ,UAAH,6CAAG,IAAKC,EAAY,UAAH,8CAE7CC,EAAO,WACNJ,IACHK,sBAAsBC,GACtBN,GAAO,IAGLO,EAAc,SAACC,GACnBP,EAAQO,EACRC,EAAS7E,QAIL6E,GAAWC,EAAAA,EAAAA,GAAS,CACxBX,GAAIK,EACJF,MAAAA,EACAC,UAAAA,IAIIQ,EAAM,YACV9C,EAAAA,EAAAA,IAAG+C,OAAQ,oBAAqBL,IAChC1C,EAAAA,EAAAA,IAAG+C,OAAQ,SAAUL,IAEjBM,EAAO,YACX7C,EAAAA,EAAAA,IAAI4C,OAAQ,oBAAqBL,IACjCvC,EAAAA,EAAAA,IAAI4C,OAAQ,SAAUL,IAElBD,EAAO,WACXP,EAAGE,GACHD,GAAO,GAEHc,EAAW,WACfL,EAASM,UACTf,GAAO,GAGHgB,EAAM,CACVD,QAASD,EACTjD,GAAI8C,EACJ3C,IAAK6C,EACLvD,IAAKgD,GAGP,OAAOU,I,wDCVT,QAtCiB,W,IAEXC,EAAMC,EAFMC,EAAU,UAAH,6CAAG,CAAEjB,MAAO,IAAKC,WAAW,GAC3CD,EAAyBiB,EAAzBjB,MAAOH,EAAkBoB,EAAlBpB,GAAII,EAAcgB,EAAdhB,UAGbvE,EAAO,WACX,IAAIwF,GAAY,EACdC,EAAMC,KAAKD,MAERJ,GAAQI,EAAMJ,EAAOf,GAAUkB,GAClCA,GAAY,EACZG,aAAaL,GAEbA,EAAQM,YAAW,WACjBP,EAAOI,EACPtB,MACCG,KAEHe,EAAOI,EAEFlB,IACHiB,GAAY,EACZrB,OAIAgB,EAAU,WACVG,GAAOK,aAAaL,GACxBA,EAAQ,MAGJF,EAAM,CACVpF,KAAAA,EACAmF,QAAAA,GAGF,OAAOC","sources":["webpack://samuelpasquier/./src/js/ui/site-scroll/SiteScroll.js","webpack://samuelpasquier/./src/js/ui/site-scroll/index.js","webpack://samuelpasquier/./src/js/utils/resize.js","webpack://samuelpasquier/./src/js/utils/throttle.js"],"sourcesContent":["import LocomotiveScroll from \"locomotive-scroll\";\n\nimport { $, $$, body, html, rect } from \"@utils/dom\";\nimport { mobile } from \"@utils/mobile\";\nimport ResizeOrientation from \"@utils/resize\";\n\nexport const SELECTOR = \"[data-scroll-container]\";\nexport const SCROLL_MIN_CLASSNAME = \"--js-scroll-min\";\nexport const SCROLL_DOWN_CLASSNAME = \"--js-scroll-down\";\nexport const SCROLL_UP_CLASSNAME = \"--js-scroll-up\";\nexport const SCROLL_DISABLE_CLASSNAME = \"--js-scroll-disabled\";\nexport const SCROLL_SECTION_SELECTOR = \".pb-row-wrapper[data-scroll-section]\";\n\nconst SCROLL_THRESHOLD = 200;\nconst SCROLL_DIFF_THRESHOLD = 2;\n\nlet SINGLETON;\n\nclass SiteScroll {\n  constructor(init = false) {\n    this.initialized = false;\n    this.hasScrolledAboveThreshold = false;\n    this.scrollDirection = null;\n    this.previousScrollY = null;\n    this.el = null;\n\n    SINGLETON = this;\n\n    this._onCall = this._onCall.bind(this);\n    this._onScroll = this._onScroll.bind(this);\n    this._onResize = this._onResize.bind(this);\n\n    this.start = this.start.bind(this);\n    this.stop = this.stop.bind(this);\n    this.update = this.update.bind(this);\n    this.scrollTo = this.scrollTo.bind(this);\n    this.scrollUp = this.scrollUp.bind(this);\n\n    init ? this.init() : null;\n  }\n\n  get name() {\n    return `SiteScroll`;\n  }\n\n  static getSingleton() {\n    return SINGLETON;\n  }\n\n  init() {\n    this.initialized = true;\n    this.hasScrolledAboveThreshold = false;\n    this.scrollDirection = null;\n    this.previousScrollY = 0;\n    this.el = $(SELECTOR);\n    this.scrollSections = [ ...$$(SCROLL_SECTION_SELECTOR, this.el) ].map(section => {\n      return {\n        section: section,\n        target: section.firstElementChild,\n      }\n    });\n\n    if( !this.ro ) this.ro = ResizeOrientation(this._onResize);\n    this.ro.run();\n\n    this.scroll = new LocomotiveScroll({\n      el: this.el,\n      smooth: true,\n      repeat: false,\n      tablet: {\n        breakpoint: 0\n      }\n    });\n\n    this.scroll.on(\"call\", this._onCall);\n    this.scroll.on(\"scroll\", this._onScroll);\n\n    this._bindEvents();\n  }\n\n  destroy() {\n    if (this.ro) this.ro.off();\n    if (this.scroll) {\n      this.scroll.off(\"call\", this._onCall);\n      this.scroll.off(\"scroll\", this._onScroll);\n      this.scroll.destroy();\n    }\n\n    if (this.emitter) {\n      this.emitter.off(`${this.name}.stop`, this.stop);\n      this.emitter.off(`${this.name}.start`, this.start);\n      this.emitter.off(`${this.name}.update`, this.update);\n      this.emitter.off(`${this.name}.scrollTo`, this.scrollTo);\n      this.emitter.off(`${this.name}.scrollUp`, this.scrollUp);\n    }\n\n    this.el = null;\n    this.scrollSections = null;\n    this.scroll = null;\n    this.initialized = false;\n    this.hasScrolledAboveThreshold = false;\n    this.scrollDirection = null;\n    this.previousScrollY = null;\n  }\n\n  update() {\n    if (this.ro) this.ro.run();\n    if (this.scroll) this.scroll.update();\n  }\n\n  start() {\n    if (!this.scroll) return;\n    this.scroll.start();\n    html.classList.remove(SCROLL_DISABLE_CLASSNAME);\n  }\n\n  stop() {\n    if (!this.scroll) return;\n    this.scroll.stop();\n    html.classList.add(SCROLL_DISABLE_CLASSNAME);\n  }\n\n  scrollTo(target, offset = 0) {\n    if (this.scroll) this.scroll.scrollTo(target, { offset : offset });\n  }\n\n  scrollUp() {\n    if (this.scroll) this.scroll.scrollTo(0, 0, 100);\n  }\n\n  _bindEvents() {\n    // start listening for window's resize event\n    if( this.ro ) this.ro.on();\n\n    // register event on global emmiter system\n    if (!this.emitter) return;\n\n    this.emitter.on(`${this.name}.stop`, this.stop);\n    this.emitter.on(`${this.name}.start`, this.start);\n    this.emitter.on(`${this.name}.update`, this.update);\n    this.emitter.on(`${this.name}.scrollTo`, this.scrollTo);\n    this.emitter.on(`${this.name}.scrollUp`, this.scrollUp);\n  }\n\n  // Called when an element has a data-scroll-call='my-call' attribute\n  // Module should register SiteScroll Emitter event matching the attribute value\n  _onCall(func, direction, obj) {\n    if (Array.isArray(func)) func.forEach(f => this._executeCall(f, direction, obj));\n    else this._executeCall(func, direction, obj);\n  }\n\n  // This method is called from external modules, all refering to this SiteScroll.* scope\n  // Example : Video.js module will register emitter.on(`SiteScroll.video`, this._myCall), but linked to an internal method inside Video class\n  _executeCall(call, direction, obj) {\n    this.emitter.emit(`${this.name}.${call}`, direction, obj);\n  }\n\n  _onScroll(instance) {\n    const { y } = instance.scroll;\n    const diff = y - this.previousScrollY;\n    const direction = diff >= 0 ? \"down\" : \"up\";\n    const threshold = y > SCROLL_THRESHOLD;\n    const isDiffEnough = Math.abs(diff) >= SCROLL_DIFF_THRESHOLD;\n\n    // save previous scroll position\n    this.previousScrollY = y;\n\n    // emit scroll y to application\n    this.emitter.emit(`${this.name}.scroll`, y);\n\n    // if scroll is greater than threshold AND was previously lower than threshold\n    if (threshold === true && this.hasScrolledAboveThreshold === false) {\n      this.hasScrolledAboveThreshold = true;\n      this.state.dispatch(\"SCROLL_MIN\", true);\n\n      body.classList.add(SCROLL_MIN_CLASSNAME);\n    }\n    // if scroll is lower than threshold AND was previously greater than threshold\n    else if (threshold === false && this.hasScrolledAboveThreshold === true) {\n      this.hasScrolledAboveThreshold = false;\n      this.state.dispatch(\"SCROLL_MIN\", false);\n\n      body.classList.remove(SCROLL_MIN_CLASSNAME);\n    }\n\n    // if scroll has scrolled enough to be take into account AND direction has changed\n    if (isDiffEnough && direction !== this.direction) {\n      // set scroll direction classname to <body>\n      if (this.direction === null)\n        body.classList.add(direction === \"down\" ? SCROLL_DOWN_CLASSNAME : SCROLL_UP_CLASSNAME);\n      else if (direction === \"down\") body.classList.replace(SCROLL_UP_CLASSNAME, SCROLL_DOWN_CLASSNAME);\n      else body.classList.replace(SCROLL_DOWN_CLASSNAME, SCROLL_UP_CLASSNAME);\n\n      // save scroll direction\n      this.scrollDirection = direction;\n\n      // set direction to state component\n      this.state.dispatch(\"SCROLL_DIRECTION\", direction);\n\n      // emit scroll direction change to application\n      this.emitter.emit(`${this.name}.direction`, direction);\n    }\n  }\n\n  _onResize() {\n    // do nothing for mobile\n    if( mobile ) return;\n\n    // force height for each sections to avoid overscrolling OR cropping at bottom of the page when using smooth-scroll\n    this.scrollSections.forEach(({section, target}) => {\n      const { height } = rect(target);\n      section.style.setProperty('--row-height', `${Math.floor(height)}px`);\n    });\n  }\n\n  // getter - setter\n  get y() {\n    return this.scroll ? this.scroll.scroll.instance.scroll.y : 0;\n  }\n  get direction() {\n    return this.scrollDirection;\n  }\n}\n\nexport default SiteScroll;\n","import SiteScroll from \"./SiteScroll\";\n\nexport const instance = new SiteScroll();\n\nexport default { instance };\n","/*\n\n──────────────────────────────────────────\n──────────────────────────────────────────\nRESIZE & ORIENTATION\n──────────────────────────────────────────\n──────────────────────────────────────────\n\nconst ro = ResizeOrientation(resize, 100, true);\n\nro.on();  // start listening to window's resize & orientation change events\nro.off(); // stop listening to window's resize & orientation change events\nro.run(); // execute object callback\n\nfunction resize(event) {\n  // do something\n}\n\n*/\n\nimport { on, off } from \"./listener\";\nimport Throttle from \"./throttle\";\n\nconst ResizeOrientation = (cb, delay = 200, onlyAtEnd = false) => {\n  // PRIVATE API\n  const gRaf = () => {\n    if (!tick) {\n      requestAnimationFrame(_run);\n      tick = true;\n    }\n  };\n  const getThrottle = (e) => {\n    event = e;\n    throttle.init();\n  };\n\n  let tick, event;\n  const throttle = Throttle({\n    cb: gRaf,\n    delay,\n    onlyAtEnd\n  });\n\n  // PUBLIC API\n  const _on = () => {\n    on(window, \"orientationchange\", getThrottle);\n    on(window, \"resize\", getThrottle);\n  };\n  const _off = () => {\n    off(window, \"orientationchange\", getThrottle);\n    off(window, \"resize\", getThrottle);\n  };\n  const _run = () => {\n    cb(event);\n    tick = false;\n  };\n  const _dispose = () => {\n    throttle.dispose();\n    tick = true;\n  };\n\n  const ctx = {\n    dispose: _dispose,\n    on: _on,\n    off: _off,\n    run: _run\n  };\n\n  return ctx;\n};\n\nexport default ResizeOrientation;\n","/*\n\n──────────────────────────────────────────\n──────────────────────────────────────────\nTHROTTLE\n──────────────────────────────────────────\n──────────────────────────────────────────\n\n►►►  firstTime for window resizer\n\nconst throttle = new S.Throttle({\n    cb: callback,\n    delay: 200\n    onlyAtEnd: true\n})\n\nthrottle.init()\n\n*/\n\nconst Throttle = (options = { delay: 200, onlyAtEnd: false }) => {\n  const { delay, cb, onlyAtEnd } = options;\n  let last, timer;\n\n  const init = () => {\n    let firstTime = true,\n      now = Date.now();\n\n    if ((last && now < last + delay) || firstTime) {\n      firstTime = false;\n      clearTimeout(timer);\n\n      timer = setTimeout(function () {\n        last = now;\n        cb();\n      }, delay);\n    } else {\n      last = now;\n\n      if (!onlyAtEnd) {\n        firstTime = false;\n        cb();\n      }\n    }\n  };\n  const dispose = () => {\n    if (timer) clearTimeout(timer);\n    timer = null;\n  };\n\n  const ctx = {\n    init,\n    dispose\n  };\n\n  return ctx;\n};\n\nexport default Throttle;\n"],"names":["SINGLETON","SCROLL_MIN_CLASSNAME","SCROLL_DOWN_CLASSNAME","SCROLL_UP_CLASSNAME","SCROLL_DISABLE_CLASSNAME","SiteScroll","init","this","initialized","hasScrolledAboveThreshold","scrollDirection","previousScrollY","el","_onCall","bind","_onScroll","_onResize","start","stop","update","scrollTo","scrollUp","name","$","scrollSections","$$","map","section","target","firstElementChild","ro","ResizeOrientation","run","scroll","LocomotiveScroll","smooth","repeat","tablet","breakpoint","on","_bindEvents","destroy","off","emitter","html","offset","func","direction","obj","Array","isArray","forEach","f","_executeCall","call","emit","instance","y","diff","threshold","isDiffEnough","Math","abs","state","dispatch","body","mobile","height","rect","style","setProperty","floor","getSingleton","cb","tick","event","delay","onlyAtEnd","gRaf","requestAnimationFrame","_run","getThrottle","e","throttle","Throttle","_on","window","_off","_dispose","dispose","ctx","last","timer","options","firstTime","now","Date","clearTimeout","setTimeout"],"sourceRoot":""}