{"version":3,"file":"js/src_js_ui_locomotive-scroll-youtube_index_js.b8eba48c9f380a4b1023.bundle.js","mappings":"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","sources":["webpack://samuelpasquier/./src/js/utils/youtube-api.js","webpack://samuelpasquier/./src/js/ui/locomotive-scroll-youtube/LocomotiveScrollYoutube.js","webpack://samuelpasquier/./src/js/ui/locomotive-scroll-youtube/index.js"],"sourcesContent":["import { head } from \"@utils/dom\";\n\nclass YoutubeAPI {\n  constructor() {\n    this._script = null;\n    this._ready = false;\n    this._promises = [];\n\n    window.onYouTubeIframeAPIReady = () => {\n      this._ready = true;      \n      this._promises.forEach(promise => promise());\n      this._promises = null;\n\n      window.onYouTubeIframeAPIReady = null;\n    }\n  }\n\n  load() {\n    if( this._ready ) return Promise.resolve();\n\n    const promise = new Promise((resolve) => this._promises.push(resolve));    \n\n    if( !this._script ) {\n      this._script = document.createElement(\"script\");\n      this._script.onerror = e => { console.error(\"Error loading Youtube iFrame API :\", e); };\n      this._script.src = \"https://www.youtube.com/iframe_api\";\n\n      head.appendChild(this._script);\n    }\n\n    return promise;\n  }\n\n  // getter\n  get ready() { return this._ready; }\n}\n\nconst SINGLETON = new YoutubeAPI();\nexport default SINGLETON;\n","import { $$ } from \"@utils/dom\";\nimport { mobile } from \"@utils/mobile\";\nimport YoutubeAPI from \"@utils/youtube-api\";\n\nexport const SELECTOR = `.wysiwyg iframe[src*=\"youtube.com\"]`;\n\nconst STATUS_DESTROYED = 0;\nconst STATUS_INITIALIZED = 1;\nconst STATUS_STOPPED = 2;\nconst STATUS_STARTED = 3;\n\nlet UDID = 1;\n\nclass LocomotiveScrollYoutube {\n  constructor(init = false) {\n    this.items = null;\n\n    this._elements = null;\n    this._status = STATUS_DESTROYED;\n\n    this._initChildren = this._initChildren.bind(this);\n\n    init ? this.init() : null;\n  }\n\n  init() {\n    // do nothing for mobile\n    if (mobile) return;\n\n    // query all elements that will turn into LocomotiveScrollYoutubeItem later\n    this._elements = Array.from($$(SELECTOR));\n\n    // if there is no elements, skip here\n    if( !this._elements || this._elements.length === 0 ) return;\n\n    // set status as initialized\n    this._status = STATUS_INITIALIZED;\n\n    // load Youtube API\n    YoutubeAPI.load().then(() => {\n      // if status is lower than initialized (ex: destroyed), do nothing\n      if( this._status < STATUS_INITIALIZED ) return;\n      \n      // create childs\n      this._initChildren();\n\n      // if status is started, start childs\n      if( this._status === STATUS_STARTED ) this.start();\n    });\n  }\n  destroy() {\n    if (this.items) this.items.forEach(el => el.destroy());\n    this.items = null;\n\n    this._elements = null;\n    this._status = STATUS_DESTROYED;\n  }\n\n  start() {\n    this._status = STATUS_STARTED;\n    if (this.items) this.items.forEach(el => el.start());\n  }\n  stop() {\n    if (this.items) this.items.forEach(el => el.stop());\n    this._status = STATUS_STOPPED;\n  }\n\n  add(el) {\n    // do nothing for mobile\n    if (mobile) return;\n\n    // if not already initialized, set as initialized\n    if( this._status < STATUS_INITIALIZED ) this._status = STATUS_INITIALIZED;\n\n    // load YoutubeAPI and create child instance\n    YoutubeAPI.load().then(() => {\n      // if module is destroyed during API loading, do nothing\n      if( this._status < STATUS_INITIALIZED ) return;\n\n      // create child instance\n      const item = new LocomotiveScrollYoutubeItem(el);\n\n      // save instance for later\n      if( !this.items ) this.items = [];\n      this.items.push(item);\n\n      // start instance if module is started\n      if( this._status === STATUS_STARTED ) item.start();\n    });\n  }\n  remove(el) {\n    // remove from uninitialized element if exists\n    if( this._elements ) this._elements = this._elements.filter(element => element !== el);\n\n    // remove from items\n    if( this.items ) {\n      // find his index in array\n      const index = this.items.findIndex(item => item.el === el);\n\n      // if found in array, stop and remove instance\n      if( index > -1 ) {\n        const item = this.items.splice(index, 1)[0];\n              item.stop();\n              item.destroy();\n      }\n    }\n  }\n\n  _initChildren() {\n    this.items = this._elements.map(el => new LocomotiveScrollYoutubeItem(el));\n    this._elements = null;\n  }\n}\n\nclass LocomotiveScrollYoutubeItem {\n  constructor(el) {\n    this.el = el;\n    this.parent = this.el.parentNode;\n    this.udid = this.el.id ? this.el.id : null;\n\n    if( !this.udid ) {\n      this.udid = `youtube-smooth-scroll--${UDID++}`;\n      this.el.id = this.udid;\n    }\n\n    const urlParams = new URLSearchParams(this.el.src);\n\n    this._autoplay = urlParams.get('autoplay') === '1';\n    this._playerReady = false;\n    this._playerStatus = null;\n\n    this._onClick = this._onClick.bind(this);\n    this._onReady = this._onReady.bind(this);\n    this._onStateChange = this._onStateChange.bind(this);\n  }\n\n  destroy() {\n    if (this.player) this.player.destroy();\n\n    this.el = null;\n    this.parent = null;\n    this.player = null;\n    this.udid = null;\n\n    this._autoplay = null;\n    this._playerReady = null;\n    this._playerStatus = null;\n\n    this._onClick = null;\n    this._onReady = null;\n    this._onStateChange = null;\n  }\n  start() {\n    this._bindEvents();\n\n    // autoplay hack\n    if( this._autoplay ) {\n      this._onClick();\n      this._onStateChange({data: YT.PlayerState.PLAYING});\n    }\n  }\n  stop() {\n    this._unbindEvents();\n\n    if (this.player) {\n      this.player.removeEventListener(\"onReady\", this._onReady);\n      this.player.removeEventListener(\"onStateChange\", this._onStateChange);\n    }\n  }\n\n  _bindEvents() {\n    if (this.parent) {\n      this.el.style.pointerEvents = \"none\";\n\n      this.parent.removeEventListener(\"click\", this._onClick);\n      this.parent.addEventListener(\"click\", this._onClick);\n    }\n  }\n  _unbindEvents() {\n    if (this.parent) {\n      this.el.style.pointerEvents = \"\";\n      this.parent.removeEventListener(\"click\", this._onClick);\n    }\n  }\n\n  _onClick(event) {\n    if (event) {\n      event.stopPropagation();\n      event.preventDefault();\n    }\n\n    if (!this.player) {\n      this.player = new YT.Player(this.udid);\n      this.player.addEventListener(\"onReady\", this._onReady);\n      this.player.addEventListener(\"onStateChange\", this._onStateChange);\n    } else if( this._playerReady === true ) {\n      this.player.playVideo();\n    }\n  }\n  _onReady() {\n    this._playerReady = true;\n    this.player.playVideo();\n\n    this._unbindEvents();\n  }\n  _onStateChange(event) {\n    this._playerReady = true;\n    \n    // on pause or ended\n    if(event.data === YT.PlayerState.PAUSED || event.data === YT.PlayerState.ENDED) this._bindEvents();\n    // on playing\n    else if(event.data === YT.PlayerState.PLAYING) this._unbindEvents();\n  }\n}\n\nexport default LocomotiveScrollYoutube;\n","import LocomotiveScrollYoutube from \"./LocomotiveScrollYoutube\";\n\nexport const instance = new LocomotiveScrollYoutube();\n\nexport default { instance };\n"],"names":["YoutubeAPI","this","_script","_ready","_promises","window","onYouTubeIframeAPIReady","forEach","promise","load","Promise","resolve","push","document","createElement","onerror","e","console","error","src","head","ready","SELECTOR","UDID","LocomotiveScrollYoutube","init","items","_elements","_status","_initChildren","bind","mobile","Array","from","$$","length","then","start","destroy","el","stop","add","item","LocomotiveScrollYoutubeItem","remove","filter","element","index","findIndex","splice","map","parent","parentNode","udid","id","urlParams","URLSearchParams","_autoplay","get","_playerReady","_playerStatus","_onClick","_onReady","_onStateChange","player","_bindEvents","data","YT","PlayerState","PLAYING","_unbindEvents","removeEventListener","style","pointerEvents","addEventListener","event","stopPropagation","preventDefault","playVideo","Player","PAUSED","ENDED","instance"],"sourceRoot":""}