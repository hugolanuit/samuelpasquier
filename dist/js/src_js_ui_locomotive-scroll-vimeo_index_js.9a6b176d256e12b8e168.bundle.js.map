{"version":3,"file":"js/src_js_ui_locomotive-scroll-vimeo_index_js.9a6b176d256e12b8e168.bundle.js","mappings":"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","sources":["webpack://samuelpasquier/./src/js/ui/locomotive-scroll-vimeo/LocomotiveScrollVimeo.js","webpack://samuelpasquier/./src/js/ui/locomotive-scroll-vimeo/index.js"],"sourcesContent":["import { $$ } from \"@utils/dom\";\nimport { mobile } from \"@utils/mobile\";\n\nexport const SELECTOR = `.wysiwyg iframe[src*=\"vimeo.com\"]`;\n\nconst STATUS_DESTROYED = 0;\nconst STATUS_INITIALIZED = 1;\nconst STATUS_STOPPED = 2;\nconst STATUS_STARTED = 3;\n\nlet Player;\n\nclass LocomotiveScrollVimeo {\n  constructor(init = false) {\n    this.items = null;\n\n    this._elements = null;\n    this._promise = null;\n    this._status = STATUS_DESTROYED;\n\n    init ? this.init() : null;\n  }\n\n  init() {\n    // do nothing for mobile\n    if (mobile) return;\n\n    // query all elements that will turn into LocomotiveScrollVimeoItem later\n    this._elements = Array.from($$(SELECTOR));\n\n    // if there is no elements, skip here\n    if( !this._elements || this._elements.length === 0 ) return;\n\n    // set status as initialized\n    this._status = STATUS_INITIALIZED;\n\n    // load Vimeo API\n    if( !Player && !this._promise ) {\n      this._promise = import(\"@vimeo/player\");\n      this._promise.then(chunk => {\n        Player = chunk.default;\n\n        // if status is lower than initialized (ex: destroyed), do nothing\n        if( this._status < STATUS_INITIALIZED ) return;\n        \n        // create childs\n        this._initChildren();\n\n        // if status is started, start childs\n        if( this._status === STATUS_STARTED ) this.start();\n      });\n      this._promise.catch(e => {\n        console.error(\"Error loading Vimeo Player API :\", e);\n      });\n    }\n    else if( Player ) this._initChildren();\n  }\n\n  destroy() {\n    if (this.items) this.items.forEach(el => el.destroy());\n    this.items = null;\n\n    this._elements = null;\n    this._status = STATUS_DESTROYED;\n  }\n\n  start() {\n    this._status = STATUS_STARTED;\n    if (this.items) this.items.forEach(el => el.start());\n  }\n  stop() {\n    if (this.items) this.items.forEach(el => el.stop());\n    this._status = STATUS_STOPPED;\n  }\n\n  add(el) {\n    // do nothing for mobile\n    if (mobile) return;\n\n    // if not already initialized, set as initialized\n    if( this._status < STATUS_INITIALIZED ) this._status = STATUS_INITIALIZED;\n\n    // load Vimeo API\n    if( !Player && !this._promise ) {\n      this._promise = import(\"@vimeo/player\");\n      this._promise.then(chunk => {\n        Player = chunk.default;\n\n        // if status is lower than initialized (ex: destroyed), do nothing\n        if( this._status < STATUS_INITIALIZED ) return;\n        \n        // create child instance\n        const item = new LocomotiveScrollVimeoItem(el);\n\n        // save instance for later\n        if( !this.items ) this.items = [];\n        this.items.push(item);\n\n        // start instance if module is started\n        if( this._status === STATUS_STARTED ) item.start();\n      });\n      this._promise.catch(e => {\n        console.error(\"Error loading Vimeo Player API :\", e);\n      });\n    }\n    else if( Player ) {\n      // create child instance\n      const item = new LocomotiveScrollVimeoItem(el);\n\n      // save instance for later\n      if( !this.items ) this.items = [];\n      this.items.push(item);\n\n      // start instance if module is started\n      if( this._status === STATUS_STARTED ) item.start();\n    }\n  }\n  remove(el) {\n    // remove from uninitialized element if exists\n    if( this._elements ) this._elements = this._elements.filter(element => element !== el);\n\n    // remove from items\n    if( this.items ) {\n      // find his index in array\n      const index = this.items.findIndex(item => item.el === el);\n\n      // if found in array, stop and remove instance\n      if( index > -1 ) {\n        const item = this.items.splice(index, 1)[0];\n              item.stop();\n              item.destroy();\n      }\n    }\n  }\n\n  _initChildren() {\n    this.items = this._elements.map(el => new LocomotiveScrollVimeoItem(el));\n    this._elements = null;\n  }\n}\n\nclass LocomotiveScrollVimeoItem {\n  constructor(el) {\n    this.el = el;\n    this.parent = this.el.parentNode;\n\n    // just to make sure this iframe is contained in a responsive box of our own\n    //if (!this.parent.classList.contains(\"box\")) this.parent = null;\n\n\n    const urlParams = new URLSearchParams(this.el.src);\n    this._autoplay = urlParams.get('autoplay') === '1';\n\n    this._onClick = this._onClick.bind(this);\n    this._onPlaying = this._onPlaying.bind(this);\n    this._onPause = this._onPause.bind(this);\n  }\n\n  destroy() {\n    if (this.player) this.player.destroy();\n\n    this.el = null;\n    this.parent = null;\n    this.player = null;\n\n    this._autoplay = null;\n\n    this._onClick = null;\n    this._onPlaying = null;\n    this._onPause = null;\n  }\n  start() {\n    this._bindEvents();\n\n    // autoplay hack\n    if( this._autoplay ) this._onClick();\n  }\n  stop() {\n    this._unbindEvents();\n\n    if (this.player) {\n      this.player.off(\"playing\", this._onPlaying);\n      this.player.off(\"pause\", this._onPause);\n    }\n  }\n\n  _bindEvents() {\n    if (this.parent) {\n      this.el.style.pointerEvents = \"none\";\n\n      this.parent.removeEventListener(\"click\", this._onClick);\n      this.parent.addEventListener(\"click\", this._onClick);\n    }\n  }\n  _unbindEvents() {\n    if (this.parent) {\n      this.el.style.pointerEvents = \"\";\n      this.parent.removeEventListener(\"click\", this._onClick);\n    }\n  }\n\n  _onClick(event) {\n    if (event) {\n      event.stopPropagation();\n      event.preventDefault();\n    }\n\n    if (!this.player) {\n      this.player = new Player(this.el);\n      this.player.on(\"playing\", this._onPlaying);\n      this.player.on(\"pause\", this._onPause);\n    }\n\n    this.player.play();\n  }\n  _onPlaying() {\n    this._unbindEvents();\n  }\n  _onPause() {\n    this._bindEvents();\n  }\n}\n\nexport default LocomotiveScrollVimeo;\n","import LocomotiveScrollVimeo from \"./LocomotiveScrollVimeo\";\n\nexport const instance = new LocomotiveScrollVimeo();\n\nexport default { instance };\n"],"names":["Player","SELECTOR","LocomotiveScrollVimeo","init","this","items","_elements","_promise","_status","mobile","Array","from","$$","length","_initChildren","then","chunk","default","start","catch","e","console","error","destroy","forEach","el","stop","add","item","LocomotiveScrollVimeoItem","push","remove","filter","element","index","findIndex","splice","map","parent","parentNode","urlParams","URLSearchParams","src","_autoplay","get","_onClick","bind","_onPlaying","_onPause","player","_bindEvents","_unbindEvents","off","style","pointerEvents","removeEventListener","addEventListener","event","stopPropagation","preventDefault","on","play","instance"],"sourceRoot":""}